# Can We Predict the Stock Market Using Markov Chains and Python ?

## Introduction

With the news around GameStop‚Äôs stock back in January, I took that as a sign to invest time in understanding the stock market. What I learned from the whole GameStop experience is that the stock market is not that complex as Wall Street makes it out to be, and that anyone can master investing and using the stock market to their advantage. After doing research, I wondered if there was a way we can predict the stock market? How accurate is the prediction? Does the accuracy of the prediction correlate with the volatility of the stock? These are the questions that I will be answering through my project. The main goal of this project is to use the past data to find the likelihood that the stock will increase or decrease in price by a certain amount. I will do this by collecting the historical opening and closing prices for five different companies that vary in volatility. Then, find the probability that the open and close transitions between intervals. Finally, I used the information I gathered to graph the predicted values against the actual values.

## Background

Information on of the stock market, the individual stocks, and Markov chains comes from Yahoo Finance, New York Stock Exchange, Investopedia, and Linear Algebra with Applications by W. Keith Nicholson.
Markov Chains
A Markov chain is a mathematical system in which the state it will go to next depends on only on the current state that it is in a not an any pervious history of the system. The transition probability is probability that a Markov chain with go from state ùëñ to state ùëó at any stage of the system. We can create an ùëõ ùë• ùëõ transition matrix, P, such that [p!"] is the probability that the system goes from state ùëñ to state ùëó. A stochastic matrix is a matrix who columns sum up to 1 and its entries lie between 0 and 1. A stochastic matrix is regular if some power of the matrix, has every entry greater than zero. If we assume the transition matrix of a Markov chain to be regular, then that is a unique steady-state vector s such that:
1. (ùêº ‚àí ùëÉ)ùë† = 0 ( ùêº being the ùëõ ùë• ùëõ identity matrix), and
2. The entries of ùë† are positive and sum to 1.

## Stock Market Terminology

A stock market is a collection of markets and exchanges where shares of different publicly owned companies are bought and sold. By studying historical prices, trading volume, open interest, and other trading data to study price patterns, investors can make predictions of future price changes. The stock market is open from 9:30 a.m. to 4 p.m. EST. The opening price of stock refers to the price of a single share at the beginning of a trading day. Similarly, the closing price refers to the price of a single share at the end of a trading day. Typically, a stock's opening price is not the same as its closing price from the previous day. This difference is because of after-hours trading has changed the value and expectation of the stock. After-hours trading is done from 4 p.m. to 8 p.m. EST and is the buying or selling of shares outside of regular trading hours after the market has closed. 

The industry standard for measuring the volitivity of a stock is beta. Beta is the degree to which the price of a share fluctuates in reaction to other stocks in the market and external factors in comparison to the index. A stock market index is a subset of the stock market that investors use to compare current price levels with past prices to determine market performance. Indexes such as NASDAQ, New York Stock Exchange Composite Index, The Dow Jones, and the S&P 500. The beta tells investors how that stock acts compared to all other stocks that comprise an index/stock market. Since the stock market is constantly changing, the beta for a stock will also change. A beta that is less than 0 would indicate that the stock has an inverse relation to the market. An example of this is gold stocks because as the market takes a downturn, people are more likely to buy and sell gold to save their assets. If the beta is 0, then regardless of how the market moves, the price remains unchanged. A beta between 0 and 1 means that the stock is less likely to fluctuate in relation to the index. A lot of utility companies are in this range. An example would be Sothern Company Services, they are the parent company for Georgia Power, SCANA Energy, and, among other companies, Georgia Natural Gas. A beta of 1 means that the stock mimics the volatility of the index that represents the market. If the index goes up or down by a certain amount, then there is a good chance that the stock with move in the same direction by the same amount. Lastly, if a stock has a beta greater than 1, this will mean that the company has greater volatility than the index. Companies will usually have a beta between the range of 0- 5. It is rare to have a beta any higher.

We can think of volitivity the same way as we think of demand in economics. When a negative news article comes out about a service or good, then the demand for that service or good would go down, and consumers would buy less of that product. Knowing the volitivity of a stock helps determine investors buying and selling patterns for a stock. Seeing a stock with a high beta, greater than 1, does not mean you should not invest in it; it simply means that there are some risks associated with the company. The price could shoot up or take a nosedive depending on any external factor like the news or a bad earnings report. Investing in a stock with a high beta could yield high returns but can make you lose money if something negative happened. A stock with a low beta value, less than 1, is a safe choice but you would not make much money from investing in it.

## Methodology

The five stocks that I will be using are the companies Public Storage (PSA), Overstock.com (OSTK), Newell Brands (NWL), Tesla (TSLA), and Dollar General (DG). Newell Brands is the parent company of the brands Elmer‚Äôs glue, Mr. Coffee, Sharpie, and Yankee Candle, to name a few. Public Storage is a self-storage company and, Overstock.com is an online furniture retailer. Tesla is a company focused on creating a greener planet by making electric cars, solar panels, solar roof tiles, and other products. Dollar General is a chain of stores whose main goal is to provide popular brands at a low price. I picked these stocks solely based on their beta values and that they are well-known companies. I wanted to choose two stocks with high betas, two with low betas, and one with a beta close to 1. Public Storage has a beta of 0.0842, Overstock.com has a beta of 4.5246, Newell Brands has a beta of 0.9884, Tesla has a beta of 1.9981, and Dollar General has a beta of 0.5178. The index that the beta values are calculated against is the NYSE Composite. These values are from the NYSE‚Äôs website.

I found each stock‚Äôs respective historical data and downloaded a CSV file of the closing price and opening price from January 1, 2019 - January 1, 2020. I collected this information from Yahoo Finance. I chose these dates because, for the majority of 2020, companies around the country had either less than average or more than average stock prices due to the Covid-19 pandemic and nationwide lockdowns. So, to get a more realistic prediction, I went with the 2019 calendar year. After downloading the file, I uploaded them into a Microsoft Excel document where I found the amount each stock changed each day. I did this for both the open prices and the close prices. For example, if a stock has an open price of 11 dollars one day and the next day had an open price of 9 dollars, then there is a difference of -$2 between the days. Next, I found the range of the differences for the open and close prices, then divided the range by three to get intervals. These intervals serve as states of our Markov chain and the change between the states helps determine the transition matrix. For example, if one day the stock price is in between the first interval and the next day the price moves to the third interval then it would increase the probability for ùëù#$.

Next, to calculate our transition matrix, I counted and recorded the frequency of each transition then the values of ùëù!" were divided by the total number of difference prices in the interval ùëù!. Once I calculated the transition matrices for each stock, I was able to find the steady-state vectors for each matrix.

Finally, I collected all the information that I gathered and wrote Python code to calculate my predicted values. I had the code start with at state then randomly pick a state to go to based on the probabilities of the steady-state vector. To get my predicted prices, I had to simulate the price of the stock moving up and down between the intervals. For example, if the code came across p#$this would mean the price went from being in the first interval to being in the third interval. I would then have the code add the length of two intervals to get the price to be in the third interval. I then pulled in the actual values from the CSV files and plotted them on graphs along with the predicted values. Under my data and graphs section, you will find an example of what my code looks like for each stock.

## Questions

### Is the there a way we predict the stock market?

In the long run, I would not recommend predicting the stock market in any capacity. With my method, I saw that all stock predicted values tended to veer from the actual values each around 100 days. This may be because the companies either had an unforeseen downturn or saw an increase in the price that I had not been worked into my method or code. Since I am working with a range of stocks that vary in volitivity, there is a good chance that the companies could put out news that would increase or decrease their price more than usual. Stocks can be sensitive to good or bad publicity whether or not the company is going well financially. Since these are public companies, they must report earnings in an annual report. Some companies even report every three months, like Tesla. So, if Tesla says that their earning have been down the past quarter; then this might prompt investors to either buy or sell more shares of the company.

### How accurate is the prediction and does the accuracy of the prediction correlate with the volatility of the stock?

Yes, I found that the accuracy of the prediction correlates with the volatility of the stock. As the volatility of the stocks increases, the less likely the predicted values match the actual values. The beta values that I have for each stock are from the New York Stock Exchange‚Äôs website, which calculates their beta values by comparing volatility against the NYSE Composite. Let us assume that the beta value of the NYSE Composite is 1. If a stock has a beta value of 4, that will mean that the stock is 4 times more volatile than the NYSE Composite. Given the fact that the beta of a stock can change daily, then any predictions should be taken with a grain of salt.
Out of the five stocks, I would say that PSA, which has a beta value of 0.0842, had the best outcome for both open and close prices. If we were to look at the graphs for the stock, we see that most of the time the two lines are increasing and decreasing around the same time. If we look at OSTK and TSLA, which have a beta value of 4.5246 and 1.998 respectively, the predicted values only somewhat followed the actual values. Finally, with NWL, which has a beta value of 0.9884, they had the best graph of its open price but not for the close price. NWL‚Äôs closing price graph only slightly follows the trend of the actual values. This could have to do with the beta values being close to 1.

## Conclusion

In the short run, I found that this method did general predict the stock price; however, after 100 days I would not recommend this method. One way I would improve on my method would be to use 5 intervals instead of 3. This way I could a more precise prediction. Another way that I would improve on this project would be to calculate a moving average of the prices. Then use the difference of the averages to find the probability for the transition matrix. I could eliminate most of the errors in the data and might yield better results for future values past 100 days.

## References

Chen, James. ‚ÄúStock Market.‚Äù Investopedia, Investopedia, 9 Apr. 2021, www.investopedia.com/terms/s/stockmarket.asp.
‚ÄúDollar General Corporation (DG) Stock Price, News, Quote &amp; History.‚Äù Yahoo! Finance, Yahoo!, 14 Apr. 2021, finance.yahoo.com/quote/DG?p=DG&.tsrc=fin-srch.
‚ÄúThe Intercontinental Exchange.‚Äù NYSE, www.nyse.com/index.
‚ÄúNewell Brands Inc. (NWL) Stock Price, News, Quote &amp; History.‚Äù Yahoo! Finance, Yahoo!, 14
Apr. 2021, finance.yahoo.com/quote/NWL?p=NWL&.tsrc=fin-srch.
‚ÄúOverstock.com, Inc. (OSTK) Stock Historical Prices &amp; Data.‚Äù Yahoo! Finance, Yahoo!, 14 Apr.
2021, finance.yahoo.com/quote/OSTK/history?period1=1546300800&period2=1577836800&interval= 1d&filter=history&frequency=1d&includeAdjustedClose=true.
‚ÄúPublic Storage (PSA) Stock Price, News, Quote &amp; History.‚Äù Yahoo! Finance, Yahoo!, 14 Apr. 2021, finance.yahoo.com/quote/PSA?p=PSA&.tsrc=fin-srch.
‚ÄúTesla, Inc. (TSLA) Stock Price, News, Quote &amp; History.‚Äù Yahoo! Finance, Yahoo!, 14 Apr. 2021, finance.yahoo.com/quote/TSLA?p=TSLA&.tsrc=fin-srch.
